# 記事生成スクリプト

## 概要

persona.csvとseo-keyword.csvを組み合わせて、2段階のAIモデルで記事を自動生成するスクリプトです。

## 生成フロー

```
persona.csv + seo-keyword.csv
          ↓
    [マッチング処理]
          ↓
    [記事生成モデル] ← フェーズ1: 初稿作成
          ↓
      [SEOモデル] ← フェーズ2: SEO最適化
          ↓
    article.csv に保存
```

## 使い方

### 1. 必要なファイルを準備

以下のCSVファイルが `src/data/` ディレクトリに必要です:

- `persona.csv` - ペルソナ情報
- `seo-keyword.csv` - SEOキーワード情報
- `article.csv` - 生成された記事の保存先（自動的にヘッダー付きで作成されます）

### 2. 記事生成の実行

```bash
npm run article:generate
```

### 3. 出力

生成された記事は `src/data/article.csv` に追記されます。

## article.csv のフォーマット

| カラム名 | 説明 | 例 |
|---------|------|-----|
| id | 記事ID（自動採番） | 1 |
| category_id | カテゴリID | A-01 |
| title | 記事タイトル | 介護職におすすめの副業5選 |
| body | 記事本文 | # はじめに... |
| slug | URL用スラッグ | kaigo-fukugyo-osusume |
| status | ステータス | draft / published |
| meta_title | メタタイトル | 介護職の副業 - おすすめランキング |
| meta_description | メタディスクリプション | 介護職でもできる副業を... |
| api_posted | API連携済みフラグ | 0 / 1 |

## 2段階生成の詳細

### フェーズ1: 記事生成モデル

**入力:**
- ペルソナ情報（カテゴリ、詳細、悩み、トーン、コンテキスト）
- SEOキーワード情報（メイン/サブキーワード、ユーザー意図、タイトル案）

**出力:**
- タイトル
- 本文
- スラッグ

**役割:**
ペルソナに響く、共感を呼ぶ記事の初稿を作成します。

### フェーズ2: SEOモデル

**入力:**
- フェーズ1で生成された記事初稿
- SEOキーワード情報

**出力:**
- SEO最適化されたタイトル
- SEO最適化された本文
- メタタイトル
- メタディスクリプション

**役割:**
検索エンジンに最適化しつつ、読みやすさを維持します。

## カスタマイズ

### モデルの変更

`.env` ファイルでOllamaのモデル名を変更できます:

```
OLLAMA_MODEL_NAME=kaigo-expert
```

### タイムアウト設定

大量の記事を生成する場合、タイムアウト時間を調整できます:

```
OLLAMA_TIMEOUT=120000
```

## トラブルシューティング

### Ollamaに接続できない

- Ollamaが起動していることを確認してください
- `.env` の `OLLAMA_BASE_URL` が正しいか確認してください

### 記事生成に失敗する

- モデルが正しくロードされているか確認してください: `npm run ollama:create`
- プロンプトが長すぎる場合、モデルのコンテキスト長を確認してください

### CSVの読み込みエラー

- CSVファイルのエンコーディングがUTF-8であることを確認してください
- カンマやダブルクォートが正しくエスケープされているか確認してください
